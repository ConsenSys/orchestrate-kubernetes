---
replicaCount: {{ .Values | get "kafka.replicas" 3 }}
defaultReplicationFactor: {{ .Values | get "kafka.replicas" 3 }}
offsetsTopicReplicationFactor: {{ .Values | get "kafka.replicas" 3 }}
fullnameOverride: kafka
logRetentionHours: 24
## Pod Disruption Budget configuration
## The PDB will only be created if replicaCount is greater than 1
## ref: https://kubernetes.io/docs/concepts/workloads/pods/disruptions
pdb:
  create: true
  ## Max number of pods that can be unavailable after the eviction
  maxUnavailable: 1
persistence:
  enabled: {{ .Values | get "kafka.persistence.enabled" true }}
  size: 4Gi
  storageClass: {{ .Values | get "kafka.persistence.storageClass" "gp2" }}
metrics:
  kafka:
    enabled: {{ .Values | get "metrics.enabled" false }}
  jmx:
    enabled: {{ .Values | get "metrics.enabled" false }}
  serviceMonitor:
    enabled: {{ .Values | get "metrics.enabled" false }}
    namespace: {{ .Values | get "metrics.namespace" }}
resources:
  requests:
    memory: 4Gi
    cpu: 100m
  limits:
    memory: 8Gi
    cpu: 500m
affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
            - key: app
              operator: In
              values:
                - kafka
            - key: job-name
              operator: DoesNotExist
        topologyKey: "failure-domain.beta.kubernetes.io/zone"
  podAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 50
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - zookeeper
          topologyKey: "kubernetes.io/hostname"
zookeeper:
  replicaCount: {{ .Values | get "zookeeper.replicas" 3 }}
  resources:
    requests:
      memory: "512Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "300m"
  persistence:
    enabled: {{ .Values | get "zookeeper.persistence.enabled" true }}
    size: 2Gi
    storageClass: {{ .Values | get "zookeeper.persistence.storageClass" "gp2" }}
  metrics:
    enabled: {{ .Values | get "metrics.enabled" false }}
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - zookeeper
          topologyKey: "failure-domain.beta.kubernetes.io/zone"
